<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <script src="sweetalert2.min.js"></script>
    <link rel="stylesheet" href="sweetalert2.min.css">

    <title>Welcome <%= json.username%></title>
  </head>
  <body>
    <nav class="navbar navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand">URL Shortener</a>
        <form class="d-flex" method="POST" action="/logout">
          <button type="submit" class="btn btn-primary">Logout</button>
        </form>
      </div>
    </nav>    
    <br>
    <u><center><h1>Welcome <%= json.username %></h1></center></u><br>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <ul><li><h3>Short URLs you have created so far</h3></li></ul><br>
    <h4><center>Example code usage:- http://localhost/{CODE}</center></h4><br>
    <% if(URL_CODE.length === 0){ %>
      <center><h3>You haven't created any short URL's yet</h3></center>
      <% } else{ %>
    <br>
    <div class="row row-cols-1 row-cols-md-3 g-4">
    <% URL_CODE.forEach(function(code) { %>
        <div class="col-sm-6">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">
                <a href="<%= code.long_url %>" class="btn btn-primary">Long URL - <%= code.long_url_nickname %></a></h5>
              <p class="card-text">You can click below link and site will automatically redirect to the desired site. Shorter URL Code Below ðŸ‘‡</p>
              <span id="shortCode" style="display:none !important"><%= code.short_url_code %></span>
              <a href="https://pasindudushan-url-shortener-w66w5xr63v5r6-5000.githubpreview.dev/<%= code.short_url_code %>" class="btn btn-primary">Short URL Code - <%= code.short_url_code %></a><br><br>
                <button onclick="deleteUrl()" class="btn btn-primary">Delete URL</button>
            </div>
          </div>
        </div>
    <% }); %><br>
  </div>
  <% } %>
 <br>
 <% if(!DISCORD_USER.account_verified){ %>
  <center><form id="mainform"class="needs-validation" method="POST" action="/addurl/success" novalidate>
    <div class="col-md-4">
      <label for="validationCustom01" class="form-label">Long URL</label>
      <input type="text" class="form-control" disabled name="id" id="validationCustom01" placeholder="https://yourlongdomain.com" required>
      <div class="invalid-feedback">
        You must type a long url
      </div>
    </div><br>
    <div class="col-md-4">
      <label for="validationCustom01" class="form-label">Nickname for long URL</label>
      <input type="text" class="form-control" disabled name="nickname" id="validationCustom01" placeholder="A Nickname" maxlength="25" required>
      <div class="invalid-feedback">
        You must type a nickname
      </div>
    </div><br>
    <div class="col-12" style="display: flex; justify-content: center;">
      <button type="submit" disabled class="btn btn-primary">Create</button>
    </div><br>
  </form>
 </center>
  <% } else{ %>
  <center><form id="mainform"class="needs-validation" method="POST" action="/addurl/success" novalidate>
    <div class="col-md-4">
      <label for="validationCustom01" class="form-label">Long URL</label>
      <input type="text" class="form-control" name="id" id="validationCustom01" placeholder="https://yourlongdomain.com" required>
      <div class="invalid-feedback">
        You must type a long url
      </div>
    </div><br>
    <div class="col-md-4">
      <label for="validationCustom01" class="form-label">Nickname for long URL</label>
      <input type="text" class="form-control" name="nickname" id="validationCustom01" placeholder="A Nickname" maxlength="25" required>
      <div class="invalid-feedback">
        You must type a nickname
      </div>
    </div><br>
    <div class="col-12" style="display: flex; justify-content: center;">
      <button type="submit" class="btn btn-primary">Create</button>
    </div><br>
  </form>
 </center>
 <% } %>
  </body>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</html>

<style>
  body{
    background-color: #5D6D7E;
  }
</style>

<script>
(function () {
'use strict'

var forms = document.querySelectorAll('.needs-validation')
let code = document.getElementById("shortCode").innerHTML

Array.prototype.slice.call(forms)
  .forEach(function (form) {
    form.addEventListener('submit', function (event) {
      if (!form.checkValidity()) {
        event.preventDefault()
        event.stopPropagation()
      }

      form.classList.add('was-validated')
    }, false)
  })
})()

function deleteUrl(){
Swal.fire(
  'Delete the URL from the account?',
  'Are you sure?',
  'question'
).then((result) => {
  if (result.isConfirmed) {
    fetch("/delete/success/" + code, {
      method: "POST",
    })
    Swal.fire('Alright then!', 'URL Deleted!', 'success')
    window.location.reload()
  } 
})
}
</script>
